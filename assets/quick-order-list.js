class QuickOrderListRemoveButton extends HTMLElement{constructor(){super(),this.addEventListener("click",event=>{event.preventDefault(),this.closest("quick-order-list").updateQuantity(this.dataset.index,0)})}}customElements.define("quick-order-list-remove-button",QuickOrderListRemoveButton);class QuickOrderListRemoveAllButton extends HTMLElement{constructor(){super();const allVariants=Array.from(document.querySelectorAll("[data-variant-id]")),items={};let hasVariantsInCart=!1;this.quickOrderList=this.closest("quick-order-list"),allVariants.forEach(variant=>{parseInt(variant.dataset.cartQty)>0&&(hasVariantsInCart=!0,items[parseInt(variant.dataset.variantId)]=0)}),hasVariantsInCart||this.classList.add("hidden"),this.actions={confirm:"confirm",remove:"remove",cancel:"cancel"},this.addEventListener("click",event=>{event.preventDefault(),this.dataset.action===this.actions.confirm?this.toggleConfirmation(!1,!0):this.dataset.action===this.actions.remove?(this.quickOrderList.updateMultipleQty(items),this.toggleConfirmation(!0,!1)):this.dataset.action===this.actions.cancel&&this.toggleConfirmation(!0,!1)})}toggleConfirmation(showConfirmation,showInfo){this.quickOrderList.querySelector(".quick-order-list-total__confirmation").classList.toggle("hidden",showConfirmation),this.quickOrderList.querySelector(".quick-order-list-total__info").classList.toggle("hidden",showInfo)}}customElements.define("quick-order-list-remove-all-button",QuickOrderListRemoveAllButton);class QuickOrderList extends HTMLElement{constructor(){super(),this.cart=document.querySelector("cart-drawer"),this.actions={add:"ADD",update:"UPDATE"},this.quickOrderListId="quick-order-list",this.variantItemStatusElement=document.getElementById("shopping-cart-variant-item-status"),this.querySelector("form").addEventListener("submit",this.onSubmit.bind(this));const debouncedOnChange=debounce(event=>{this.onChange(event)},ON_CHANGE_DEBOUNCE_TIMER);this.addEventListener("change",debouncedOnChange.bind(this))}cartUpdateUnsubscriber=void 0;onSubmit(event){event.preventDefault()}connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,event=>{event.source!==this.quickOrderListId&&this.onCartUpdate()}),this.sectionId=this.dataset.id}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber()}onChange(event){const inputValue=parseInt(event.target.value),cartQuantity=parseInt(event.target.dataset.cartQuantity),index=event.target.dataset.index,name=document.activeElement.getAttribute("name"),quantity=inputValue-cartQuantity;cartQuantity>0?this.updateQuantity(index,inputValue,name,this.actions.update):this.updateQuantity(index,quantity,name,this.actions.add)}onCartUpdate(){fetch(`${window.location.pathname}?section_id=${this.sectionId}`).then(response=>response.text()).then(responseText=>{const sourceQty=new DOMParser().parseFromString(responseText,"text/html").querySelector(this.quickOrderListId);this.innerHTML=sourceQty.innerHTML}).catch(e=>{console.error(e)})}getSectionsToRender(){return[{id:this.quickOrderListId,section:document.getElementById(this.quickOrderListId).dataset.id,selector:".js-contents"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"quick-order-list-live-region-text",section:"cart-live-region-text",selector:".shopify-section"},{id:"quick-order-list-total",section:document.getElementById(this.quickOrderListId).dataset.id,selector:".quick-order-list__total"},{id:"CartDrawer",selector:"#CartDrawer",section:"cart-drawer"}]}renderSections(parsedState){this.getSectionsToRender().forEach(section=>{const sectionElement=document.getElementById(section.id);sectionElement&&sectionElement.parentElement&&sectionElement.parentElement.classList.contains("drawer")&&(parsedState.items.length>0?sectionElement.parentElement.classList.remove("is-empty"):sectionElement.parentElement.classList.add("is-empty"),setTimeout(()=>{document.querySelector("#CartDrawer-Overlay").addEventListener("click",this.cart.close.bind(this.cart))}));const elementToReplace=sectionElement&&sectionElement.querySelector(section.selector)?sectionElement.querySelector(section.selector):sectionElement;elementToReplace&&(elementToReplace.innerHTML=this.getSectionInnerHTML(parsedState.sections[section.section],section.selector))})}updateMultipleQty(items){this.querySelector(".variant-remove-total .loading__spinner").classList.remove("hidden");const body=JSON.stringify({updates:items,sections:this.getSectionsToRender().map(section=>section.section),sections_url:window.location.pathname});this.updateMessage(),this.setErrorMessage(),fetch(`${routes.cart_update_url}`,{...fetchConfig(),body}).then(response=>response.text()).then(state=>{const parsedState=JSON.parse(state);this.renderSections(parsedState)}).catch(()=>{this.setErrorMessage(window.cartStrings.error)}).finally(()=>{this.querySelector(".variant-remove-total .loading__spinner").classList.add("hidden")})}updateQuantity(id,quantity,name,action){this.toggleLoading(id,!0);let routeUrl=routes.cart_change_url,body=JSON.stringify({quantity,id,sections:this.getSectionsToRender().map(section=>section.section),sections_url:window.location.pathname}),fetchConfigType;action===this.actions.add&&(fetchConfigType="javascript",routeUrl=routes.cart_add_url,body=JSON.stringify({items:[{quantity:parseInt(quantity),id:parseInt(id)}],sections:this.getSectionsToRender().map(section=>section.section),sections_url:window.location.pathname})),this.updateMessage(),this.setErrorMessage(),fetch(`${routeUrl}`,{...fetchConfig(fetchConfigType),body}).then(response=>response.text()).then(state=>{const parsedState=JSON.parse(state),quantityElement=document.getElementById(`Quantity-${id}`),items=document.querySelectorAll(".variant-item");if(parsedState.description||parsedState.errors){document.querySelector(`[id^="Variant-${id}"] .variant-item__totals.small-hide .loading__spinner`).classList.add("loading__spinner--error"),this.resetQuantityInput(id,quantityElement),parsedState.errors?this.updateLiveRegions(id,parsedState.errors):this.updateLiveRegions(id,parsedState.description);return}this.classList.toggle("is-empty",parsedState.item_count===0),this.renderSections(parsedState);let hasError=!1;const currentItem=parsedState.items.find(item=>item.variant_id===parseInt(id)),updatedValue=currentItem?currentItem.quantity:void 0;updatedValue&&updatedValue!==quantity&&(this.updateError(updatedValue,id),hasError=!0);const variantItem=document.getElementById(`Variant-${id}`);variantItem&&variantItem.querySelector(`[name="${name}"]`)&&variantItem.querySelector(`[name="${name}"]`).focus(),publish(PUB_SUB_EVENTS.cartUpdate,{source:this.quickOrderListId,cartData:parsedState}),hasError?this.updateMessage():action===this.actions.add?this.updateMessage(parseInt(quantity)):action===this.actions.update?this.updateMessage(parseInt(quantity-quantityElement.dataset.cartQuantity)):this.updateMessage(-parseInt(quantityElement.dataset.cartQuantity))}).catch(error=>{this.querySelectorAll(".loading__spinner").forEach(overlay=>overlay.classList.add("hidden")),this.resetQuantityInput(id),console.error(error),this.setErrorMessage(window.cartStrings.error)}).finally(()=>{this.toggleLoading(id)})}resetQuantityInput(id,quantityElement){const input=quantityElement??document.getElementById(`Quantity-${id}`);input.value=input.getAttribute("value")}setErrorMessage(message=null){this.errorMessageTemplate=this.errorMessageTemplate??document.getElementById(`QuickOrderListErrorTemplate-${this.sectionId}`).cloneNode(!0),document.querySelectorAll(".quick-order-list-error").forEach(errorElement=>{if(errorElement.innerHTML="",!message)return;const updatedMessageElement=this.errorMessageTemplate.cloneNode(!0);updatedMessageElement.content.querySelector(".quick-order-list-error-message").innerText=message,errorElement.appendChild(updatedMessageElement.content)})}updateMessage(quantity=null){const messages=this.querySelectorAll(".quick-order-list__message-text"),icons=this.querySelectorAll(".quick-order-list__message-icon");if(quantity===null||isNaN(quantity)){messages.forEach(message=>message.innerHTML=""),icons.forEach(icon=>icon.classList.add("hidden"));return}const isQuantityNegative=quantity<0,absQuantity=Math.abs(quantity),textTemplate=isQuantityNegative?absQuantity===1?window.quickOrderListStrings.itemRemoved:window.quickOrderListStrings.itemsRemoved:quantity===1?window.quickOrderListStrings.itemAdded:window.quickOrderListStrings.itemsAdded;messages.forEach(msg=>msg.innerHTML=textTemplate.replace("[quantity]",absQuantity)),isQuantityNegative||icons.forEach(i=>i.classList.remove("hidden"))}updateError(updatedValue,id){let message="";typeof updatedValue>"u"?message=window.cartStrings.error:message=window.cartStrings.quantityError.replace("[quantity]",updatedValue),this.updateLiveRegions(id,message)}updateLiveRegions(id,message){const variantItemErrorDesktop=document.getElementById(`Quick-order-list-item-error-desktop-${id}`),variantItemErrorMobile=document.getElementById(`Quick-order-list-item-error-mobile-${id}`);variantItemErrorDesktop&&(variantItemErrorDesktop.querySelector(".variant-item__error-text").innerHTML=message,variantItemErrorDesktop.closest("tr").classList.remove("hidden")),variantItemErrorMobile&&(variantItemErrorMobile.querySelector(".variant-item__error-text").innerHTML=message),this.variantItemStatusElement.setAttribute("aria-hidden",!0);const cartStatus=document.getElementById("quick-order-list-live-region-text");cartStatus.setAttribute("aria-hidden",!1),setTimeout(()=>{cartStatus.setAttribute("aria-hidden",!0)},1e3)}getSectionInnerHTML(html,selector){return new DOMParser().parseFromString(html,"text/html").querySelector(selector).innerHTML}toggleLoading(id,enable){const quickOrderList=document.getElementById(this.quickOrderListId),quickOrderListItems=this.querySelectorAll(`#Variant-${id} .loading__spinner`);enable?(quickOrderList.classList.add("quick-order-list__container--disabled"),[...quickOrderListItems].forEach(overlay=>overlay.classList.remove("hidden")),document.activeElement.blur(),this.variantItemStatusElement.setAttribute("aria-hidden",!1)):(quickOrderList.classList.remove("quick-order-list__container--disabled"),quickOrderListItems.forEach(overlay=>overlay.classList.add("hidden")))}}customElements.define("quick-order-list",QuickOrderList);
//# sourceMappingURL=/s/files/1/0282/8425/6353/t/173/assets/quick-order-list.js.map?v=1710321142
